"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t,i){window.otlGetTranslated=function(e,t){return elementorCommon.translate(e,null,t,OceanLibraryEditor.i18n)};var n={Views:{},Models:{},Collections:{},Behaviors:{},Layout:null,Manager:null};n.Models.Template=Backbone.Model.extend({defaults:{template_id:0,title:"",type:"",folder:"",thumbnail:"",url:"",tags:[],isPlus:0}}),n.Collections.Template=Backbone.Collection.extend({model:n.Models.Template}),n.Behaviors.InsertTemplate=Marionette.Behavior.extend({ui:{insertButton:".otl-template-library-insert-button"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){i.library.insertTemplate({model:this.view.model})}}),n.Views.EmptyTemplateCollection=Marionette.ItemView.extend({id:"tmpl-otl-template-library-templates",template:"#tmpl-otl-template-library-empty",ui:{title:".elementor-template-library-blank-title",message:".elementor-template-library-blank-message"},modesStrings:{empty:{title:otlGetTranslated("templatesEmptyTitle"),message:otlGetTranslated("templatesEmptyMessage")},noResults:{title:otlGetTranslated("templatesNoResultsTitle"),message:otlGetTranslated("templatesNoResultsMessage")}},getCurrentMode:function(){return i.library.getFilter("text")?"noResults":"empty"},onRender:function(){var e=this.modesStrings[this.getCurrentMode()];this.ui.title.html(e.title),this.ui.message.html(e.message)}}),n.Views.Loading=Marionette.ItemView.extend({template:"#tmpl-otl-template-library-loading",id:"otl-template-library-loading"}),n.Views.Logo=Marionette.ItemView.extend({template:"#tmpl-otl-template-library-header-logo",className:"otl-template-library-header-logo",templateHelpers:function(){return{title:this.getOption("title")}}}),n.Views.BackButton=Marionette.ItemView.extend({template:"#tmpl-otl-template-library-header-back",id:"elementor-template-library-header-preview-back",className:"otl-template-library-header-back",events:function(){return{click:"onClick"}},onClick:function(){i.library.showTemplatesView()}}),n.Views.Menu=Marionette.ItemView.extend({template:"#tmpl-otl-template-library-header-menu",id:"elementor-template-library-header-menu",className:"otl-template-library-header-menu",templateHelpers:function(){return i.library.getTabs()},ui:{menuItem:".elementor-template-library-menu-item"},events:{"click @ui.menuItem":"onMenuItemClick"},onMenuItemClick:function(e){i.library.setFilter("tags",""),i.library.setFilter("text",""),i.library.setFilter("type",e.currentTarget.dataset.tab,1),i.library.showTemplatesView()}}),n.Views.ResponsiveMenu=Marionette.ItemView.extend({template:"#tmpl-otl-template-library-header-menu-responsive",id:"elementor-template-library-header-menu-responsive",className:"otl-template-library-header-menu-responsive",ui:{items:"> .elementor-component-tab"},events:{"click @ui.items":"onTabItemClick"},onTabItemClick:function(t){var n=e(t.currentTarget),l=n.data("tab");i.library.channels.tabs.trigger("change:device",l,n)}}),n.Views.Actions=Marionette.ItemView.extend({template:"#tmpl-otl-template-library-header-actions",id:"elementor-template-library-header-actions",ui:{sync:"#otl-template-library-header-sync i"},events:{"click @ui.sync":"onSyncClick"},onSyncClick:function(){var e=this;e.ui.sync.addClass("eicon-animation-spin"),i.library.requestLibraryData({onUpdate:function(){e.ui.sync.removeClass("eicon-animation-spin"),i.library.updateBlocksView()},forceUpdate:1,forceSync:1})}}),n.Views.InsertWrapper=Marionette.ItemView.extend({template:"#tmpl-otl-template-library-header-insert",id:"elementor-template-library-header-preview",behaviors:{insertTemplate:{behaviorClass:n.Behaviors.InsertTemplate}}}),n.Views.Preview=Marionette.ItemView.extend({template:"#tmpl-otl-template-library-preview",className:"otl-template-library-preview",ui:function(){return{iframe:"> iframe"}},onRender:function(){this.ui.iframe.attr("src",this.getOption("url")).hide();var e=this,t=(new n.Views.Loading).render();this.$el.append(t.el),this.ui.iframe.on("load",function(){e.$el.find("#otl-template-library-loading").remove(),e.ui.iframe.show()})}}),n.Views.TemplateCollection=Marionette.CompositeView.extend({template:"#tmpl-otl-template-library-templates",id:"otl-template-library-templates",className:function(){return"otl-template-library-templates otl-template-library-templates--"+i.library.getFilter("type")},childViewContainer:"#otl-template-library-templates-list",emptyView:function(){return new n.Views.EmptyTemplateCollection},ui:{templatesWindow:".otl-template-library-templates-window",textFilter:"#otl-template-library-search",tagsFilter:"#otl-template-library-filter-tags",filterBar:"#otl-template-library-toolbar-filter",counter:"#otl-template-library-toolbar-counter"},events:{"input @ui.textFilter":"onTextFilterInput","click @ui.tagsFilter li":"onTagsFilterClick"},getChildView:function(e){return n.Views.Template},initialize:function(){this.listenTo(i.library.channels.templates,"filter:change",this._renderChildren)},filter:function(e){var t=i.library.getFilterTerms(),n=!0;return _.each(t,function(t,l){if(l=i.library.getFilter(l),l)return t.callback?((t=t.callback.call(e,l))||(n=!1),t):void 0}),n},setMasonrySkin:function(){var e;"section"===i.library.getFilter("type")&&(e=new elementorModules.utils.Masonry({container:this.$childViewContainer,items:this.$childViewContainer.children()}),this.$childViewContainer.imagesLoaded(e.run.bind(e)))},onRenderCollection:function(){this.setMasonrySkin(),this.updatePerfectScrollbar(),this.setTemplatesFoundText()},setTemplatesFoundText:function(){var e=i.library.getFilter("type"),t=this.children.length,n="<b>"+t+"</b>";n+="section"===e?" section":" "+e,1<t&&(n+="s"),this.ui.counter.html(n+=" found")},onTextFilterInput:function(){var e=this;_.defer(function(){i.library.setFilter("text",e.ui.textFilter.val())})},onTagsFilterClick:function(t){t=e(t.currentTarget);var n=t.data("tag");i.library.setFilter("tags",n),t.addClass("active").siblings().removeClass("active"),n=n?i.library.getTags()[n]:"Filter",this.ui.filterBar.find(".otl-template-library-filter-btn").html(n+' <i class="eicon-caret-down"></i>')},updatePerfectScrollbar:function(){this.perfectScrollbar||(this.perfectScrollbar=new PerfectScrollbar(this.ui.templatesWindow[0],{suppressScrollX:!0})),this.perfectScrollbar.isRtl=!1,this.perfectScrollbar.update()},setTagsFilterHover:function(){var e=this;e.ui.filterBar.hoverIntent(function(){e.ui.tagsFilter.css("display","block"),e.ui.filterBar.find(".otl-template-library-filter-btn i").addClass("eicon-caret-down").removeClass("eicon-caret-right")},function(){e.ui.tagsFilter.css("display","none"),e.ui.filterBar.find(".otl-template-library-filter-btn i").addClass("eicon-caret-right").removeClass("eicon-caret-down")},{sensitivity:50,interval:150,timeout:100})},onRender:function(){this.setTagsFilterHover(),this.updatePerfectScrollbar()}}),n.Views.Template=Marionette.ItemView.extend({template:"#tmpl-otl-template-library-template",className:"otl-template-library-template",ui:{previewButton:".otl-template-library-preview-button, .otl-template-library-template-preview"},events:{"click @ui.previewButton":"onPreviewButtonClick"},behaviors:{insertTemplate:{behaviorClass:n.Behaviors.InsertTemplate}},onPreviewButtonClick:function(){i.library.showPreviewView(this.model)}}),n.Modal=elementorModules.common.views.modal.Layout.extend({getModalOptions:function(){return{id:"otl-template-library-modal",hide:{onOutsideClick:0,onEscKeyPress:1,onBackgroundClick:0}}},getTemplateActionButton:function(e){return e=e.isPlus?"plus-button":"insert-button",e=Marionette.TemplateCache.get("#tmpl-otl-template-library-"+e),Marionette.Renderer.render(e)},showLogo:function(e){this.getHeaderView().logoArea.show(new n.Views.Logo(e))},showDefaultHeader:function(){this.showLogo({title:"OCEAN ELEMENTOR LIBRARY"});var e=this.getHeaderView();e.tools.show(new n.Views.Actions),e.menuArea.show(new n.Views.Menu)},showPreviewView:function(e){var t=this.getHeaderView();t.menuArea.show(new n.Views.ResponsiveMenu),t.logoArea.show(new n.Views.BackButton),t.tools.show(new n.Views.InsertWrapper({model:e})),this.modalContent.show(new n.Views.Preview({url:e.get("url")}))},showTemplatesView:function(e){this.showDefaultHeader(),this.modalContent.show(new n.Views.TemplateCollection({collection:e}))}}),n.Manager=function(){function i(){var i=e(this).closest(".elementor-top-section"),n=i.data("id"),l=t.documents.getCurrent().container.children;i=i.prev(".elementor-add-section");l&&_.each(l,function(e,t){n===e.id&&(d.atIndex=t)}),i.find(".elementor-add-otl-button").length||i.find(u).before(p)}function l(t,i){i.addClass("elementor-active").siblings().removeClass("elementor-active"),i=h[t]||h.desktop,e(".otl-template-library-preview").css("width",i)}function a(){var e=window.elementor.$previewContents,t=setInterval(function(){var n,l;(l=(n=e).find(u)).length&&!n.find(".elementor-add-otl-button").length&&l.before(p),n.on("click.onAddElement",".elementor-editor-section-settings .elementor-editor-element-add",i),0<e.find(".elementor-add-new-section").length&&clearInterval(t)},100);e.on("click.onAddTemplateButton",".elementor-add-otl-button",d.showModal.bind(d)),this.channels.tabs.on("change:device",l)}var r,o,s,c,m,d=this,u=".elementor-add-new-section .elementor-add-section-drag-title",p='<div class="elementor-add-section-area-button elementor-add-otl-button"> <i class="icon-otl-library"></i> </div>',h={desktop:"100%",tab:"768px",mobile:"360px"};this.atIndex=-1,this.channels={tabs:Backbone.Radio.channel("tabs"),templates:Backbone.Radio.channel("templates")},this.updateBlocksView=function(){d.setFilter("tags","",1),d.setFilter("text","",1),d.getModal().showTemplatesView(c)},this.setFilter=function(e,t,i){d.channels.templates.reply("filter:"+e,t),i||d.channels.templates.trigger("filter:change")},this.getFilter=function(e){return d.channels.templates.request("filter:"+e)},this.getFilterTerms=function(){return{tags:{callback:function(e){return _.any(this.get("tags"),function(t){return 0<=t.indexOf(e)})}},text:{callback:function(e){return e=e.toLowerCase(),0<=this.get("title").toLowerCase().indexOf(e)||_.any(this.get("tags"),function(t){return 0<=t.indexOf(e)})}},type:{callback:function(e){return this.get("type")===e}}}},this.showModal=function(){d.getModal().showModal(),d.showTemplatesView()},this.closeModal=function(){this.getModal().hideModal()},this.getModal=function(){return r=r||new n.Modal},this.init=function(){d.setFilter("type","section",!0),t.on("preview:loaded",a.bind(this))},this.getTabs=function(){var e=this.getFilter("type"),t={section:{title:"Sections"}};return _.each(t,function(i,n){e===n&&(t[e].active=!0)}),{tabs:t}},this.getTags=function(){return o},this.getTypeTags=function(){var e=d.getFilter("type");return s[e]},this.showTemplatesView=function(){d.setFilter("tags","",!0),d.setFilter("text","",!0),c?d.getModal().showTemplatesView(c):d.loadTemplates(function(){d.getModal().showTemplatesView(c)})},this.showPreviewView=function(e){d.getModal().showPreviewView(e)},this.loadTemplates=function(e){d.requestLibraryData({onBeforeUpdate:d.getModal().showLoadingView.bind(d.getModal()),onUpdate:function(){d.getModal().hideLoadingView(),e&&e()}})},this.requestLibraryData=function(e){var t;!c||e.forceUpdate?(e.onBeforeUpdate&&e.onBeforeUpdate(),t={data:{},success:function(t){c=new n.Collections.Template(t.templates),t.tags&&(o=t.tags),t.type_tags&&(s=t.type_tags),e.onUpdate&&e.onUpdate()}},e.forceSync&&(t.data.sync=!0),elementorCommon.ajax.addRequest("get_otl_library_data",t)):e.onUpdate&&e.onUpdate()},this.requestTemplateData=function(e,ty,fo,t){e={unique_id:e,data:{edit_mode:!0,display:!0,template_id:e,type:ty,folder:fo}},t&&jQuery.extend(!0,e,t),elementorCommon.ajax.addRequest("get_otl_template_data",e)},this.insertTemplate=function(e){var t=e.model,i=this;i.getModal().showLoadingView(),i.requestTemplateData(t.get("template_id"),t.get("type"),t.get("folder"),{success:function(e){i.getModal().hideLoadingView(),i.getModal().hideModal();var n={};-1!==i.atIndex&&(n.at=i.atIndex),$e.run("document/elements/import",{model:t,data:e,options:n}),i.atIndex=-1},error:function(e){i.showErrorDialog(e)},complete:function(e){i.getModal().hideLoadingView(),window.elementor.$previewContents.find(".elementor-add-section .elementor-add-section-close").click()}})},this.showErrorDialog=function(e){var t;"object"===_typeof(e)?(t="",_.each(e,function(e){t+="<div>"+e.message+".</div>"}),e=t):e?e+=".":e="<i>&#60;The error message is empty&#62;</i>",d.getErrorDialog().setMessage('The following error(s) occurred while processing the request:<div id="elementor-template-library-error-info">'+e+"</div>").show()},this.getErrorDialog=function(){return m=m||elementorCommon.dialogsManager.createWidget("alert",{id:"elementor-template-library-error-dialog",headerMessage:"An error occurred"})}},i.library=new n.Manager,i.library.init(),window.otl=i}(jQuery,window.elementor,window.otl||{});